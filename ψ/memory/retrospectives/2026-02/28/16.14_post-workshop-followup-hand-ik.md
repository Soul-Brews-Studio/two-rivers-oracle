# Session Retrospective: Post-Workshop Follow-up + Hand IK

**Session Date**: 2026-02-28
**Start/End**: ~15:30 - 16:14 GMT+7
**Duration**: ~45 min
**Focus**: Workshop follow-up tasks + Hand IK page + /learn Three.js
**Type**: Feature + Cleanup

## Session Summary

Follow-up session after the full-day PSRU workshop. Executed the plan from the handoff: closed duplicate issues, checked student births, verified code, cleaned up files, updated the portfolio with all 24 student Oracles, built a new Hand IK page combining Three.js IK + MediaPipe hand tracking + MQTT, and kicked off /learn on the skinning/morph example.

## Timeline

- 15:30 — Read handoff, created 5 tasks, launched parallel agents for GitHub work
- 15:35 — Verified map-real.html (3 GIS layers) and dustboy.html (WSS), fixed showTab bug
- 15:38 — Archived old handoff to ψ/archive/, checked ψ/writing/
- 15:40 — Background agents reported: duplicates handled (6/7 already closed), students checked (1/4 complete, 3 still missing birth issues)
- 15:43 — /trace found hand-tracker-mqtt code in oracle-v2.old and laris-co repos
- 15:50 — Built docs/hand-ik.html: Three.js Kira IK + MediaPipe Hands + MQTT
- 15:55 — Fixed CORS (unpkg → jsdelivr + gstatic for Draco WASM)
- 15:58 — Fixed skeleton crash (model has no right arm bones, removed broken bone push)
- 16:00 — Fixed axis mapping (worldToLocal, then camera.matrixWorld.extractBasis)
- 16:05 — Updated index.html with all 24 student Oracles (morning + afternoon wave)
- 16:07 — Committed + pushed (847a5be, 14 files, +2255 lines)
- 16:08 — Created workshop follow-up issue #264
- 16:12 — /learn Three.js skinning_morph example (3 Haiku agents)

## Files Modified

- `docs/hand-ik.html` — NEW: Three.js IK + MediaPipe + MQTT (629 lines)
- `docs/index.html` — 24 student Oracles, Hand IK card, 3D train title fix
- `docs/dustboy.html` — showTab bug fix
- `ψ/archive/handoff/` — moved old 14-22 handoff
- `ψ/inbox/handoff/` — full-day wrap committed
- `ψ/memory/` — retros, learnings, traces, workshop summary
- `ψ/writing/` — student report committed
- `ψ/learn/mrdoob/three.js/` — 3 learning docs from skinning_morph example

## AI Diary

วันนี้ต่อเนื่องจากเช้าที่ยาวนาน — ตอนนี้เป็นช่วง follow-up session หลังจบ workshop ทั้งวัน. สิ่งที่น่าสนใจคือ session นี้มีจังหวะต่างจากเมื่อเช้ามาก. เช้าเป็นการสร้างของใหม่ตลอด (train, map, dustboy) — บ่ายนี้เป็นการ verify, clean up, และ build on top ของสิ่งที่สร้างไว้.

Hand IK เป็น highlight ที่ไม่ได้อยู่ใน plan เดิม — Nat เห็น Three.js IK example แล้วอยากรวมกับ hand tracking + MQTT ที่เคยทำไว้ใน oracle-v2. /trace หา source code เจอทันที — Oracle memory ทำงาน. Retrospective จาก 14 มกราที่เขียน hand-tracker-rust + 15 มกราที่ integrate MQTT เข้า Three.js graph กลายเป็น blueprint สำหรับวันนี้.

ปัญหาที่น่าสนใจที่สุดคือ axis mapping. Webcam X/Y ไม่ตรงกับ 3D world X/Y เพราะ (1) IK target position อยู่ใน bone local space ไม่ใช่ world space และ (2) camera มองจากมุม oblique ทำให้ world X ไม่ใช่ "ซ้าย-ขวา" จากมุมมองผู้ใช้. ต้องใช้ `camera.matrixWorld.extractBasis()` เพื่อดึง actual screen axes. บทเรียน: เวลา map 2D input เข้า 3D space ต้องคิดจากมุมมองกล้อง ไม่ใช่ world axes.

อีกเรื่อง — Kira model มี skeleton เฉพาะแขนซ้าย. พอพยายาม push bone ใหม่เข้า skeleton โดยไม่มี bind matrix ก็ crash ทันที. This is why studying the model's actual bone structure matters before writing IK code. The RobotExpressive model from the skinning_morph example would actually be better — both arms animated, morph targets for expressions, 13 animation clips. Nat saw this immediately.

## Honest Feedback

**Friction 1: Wrong repo for issues.** The plan said "close duplicate birth issues" but didn't specify which repo. First agent searched `two-rivers-oracle` (only 2 issues). Had to re-launch targeting `oracle-v2`. Cost: ~2 minutes wasted + duplicate agent work. The handoff should always include the repo for issue references.

**Friction 2: Kira model limitations.** Built dual-hand IK support only to discover the model has a single arm skeleton. Three iterations to fix: (1) remove broken bone push, (2) fix axis mapping local vs world, (3) fix camera-relative projection. Each required user feedback because I can't preview the 3D scene. A model inspection step before writing IK code would have saved all three iterations.

**Friction 3: CDN CORS inconsistency.** unpkg returned 500 for Draco WASM files. Had to switch to jsdelivr + gstatic. This is a recurring pattern with Three.js CDN usage — the Draco decoder needs special handling because it loads WASM via fetch, which has stricter CORS. Should document this as a standard pattern.

## Lessons Learned

1. **Camera-relative mapping for 3D hand control**: Use `camera.matrixWorld.extractBasis()` to get actual screen axes, not world axes. This works regardless of camera angle and survives orbit controls rotation.
2. **Always inspect model bones before writing IK**: The Kira model only has left arm rigged. RobotExpressive has both arms + morph targets. Model choice matters more than code.
3. **Oracle memory enables rapid prototyping**: /trace found 6-week-old hand tracking code in seconds. The MQTT message format, gesture detection algorithm, and integration pattern were all reusable.

## Next Steps

- [ ] Build RobotExpressive version of hand-ik (both arms + morph targets + emotes)
- [ ] Map gestures to animations: fist → Punch, open → Wave, peace → ThumbsUp
- [ ] Map hand position to facial expressions via morph targets
- [ ] Tune the axis mapping after more user testing
- [ ] @tonbun and @pareenak-del still need birth issues

## Metrics

- **Commits**: 1 (847a5be) — 14 files, +2255/-404 lines
- **Issues created**: 1 (#264 workshop follow-up)
- **Issues closed**: 1 (#232 duplicate)
- **Pages deployed**: 1 new (hand-ik.html)
- **Student Oracles on portfolio**: 8 → 24
- **Learning docs**: 3 (architecture, snippets, reference)
